# Перед запуском:

Убедитесь, что redis запущен на localhost на дефолтном порту (6379).

Для корректной работы необходима минимальная версия redis >2.8.0

Моя версия node - 14.2.0

Запуск под windows возможен из под WSL (протестировано на версии WSL 2):

`sudo apt install redis-server`

`sudo service redis-server start`

## Запуск:

`node index`

## Start 2 or more instances:

`node index`

`node index`

`...`

## Description

Обрисованную в свободном виде структуру Redis можно посмотреть в 'schema.json'.

Рабочий - клиент, выполняющий задачи.
Генератор - клиент, генерирующий задачи.
Клиент - генератор или рабочий.

В проекте на каждый запущенный процесс устанавливается 2 соединения с Redis.

1 - клиент, отвечающий за обновление базы Redis;

2 - слушатель событий, необходимый для своевременного реагирования на истечение TTL ключей.

### Слушатель

#### Обрабатываются 2 события:

##### Cмерть генератора:

    При смерти генератора из сета клиентов каждый клиент получает свой приоритет (ранг/позиция),
    и каждый клиент пытается стать новым генератором с задержкой равной своему приоритету * runtime.
    takeoverTimeout, что гарантирует (при задержке связи с Redis равной меньше runtime.takeoverTimeout), что 2 клиента не попытаются стать генератором одновременно.
    Это необходимо, чтобы гарантировать, что новый генератор будет найден, даже если большая часть клиентов умрет в короткое время (меньше TTL) после смерти генератора.
    И, нет, для поиска нового генератора нельзя просто установить id генератора в следующий id из сета клиентов и дождаться его TTL Expire, после чего продолжить цикл поиска генератора.
    Это не будет работать при условии, что все клиенты равноправны и имеют одинаковые шансы на смерть.

##### Cмерть клиента

    При смерти клиента, клиент удаляется из сета клиентов Redis.

### Клиент:

#### Генератор:

    Генератором клиент может стать если:
      (он первый в приоритете сета клиентов или
      никто из клиентов выше в приоритете за отведенное ему время не стал генератором)
      и
      если текущий генератор мертв.
    Генератор создает задачи для рабочих и пушит их в Redis.

#### Рабочий:

    Рабочим становятся все клиенты, что не являются генератором.
    Рабочие выполняют задачи из Redis.
    Сложность задачи определяется из taskThreshold * task.length
